<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Whiteboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        #canvas { cursor: crosshair; touch-action: none; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col items-center p-8">

    <div class="w-full max-w-4xl flex justify-between items-center mb-4">
        <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
            CollabBoard
        </h1>
        <button id="clearBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg font-medium transition">
            Clear Canvas
        </button>
    </div>

    <canvas id="canvas" class="bg-white rounded-xl shadow-2xl border-4 border-slate-700 w-full max-w-4xl"></canvas>

    <script>
        const socket = io();
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const clearBtn = document.getElementById('clearBtn');

        // Set canvas size
        canvas.width = canvas.offsetWidth;
        canvas.height = 600;

        let drawing = false;
        let color = '#' + Math.floor(Math.random()*16777215).toString(16); // Random user color

        // Drawing Settings
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.strokeStyle = color;

        const startDrawing = (e) => {
            drawing = true;
            draw(e);
        };

        const stopDrawing = () => {
            drawing = false;
            ctx.beginPath(); // Reset path so lines don't connect weirdly
        };

        const draw = (e) => {
            if (!drawing) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Local drawing
            renderDraw(x, y, color);

            // Emit to server
            socket.emit('draw', { x, y, color });
        };

        const renderDraw = (x, y, strokeColor) => {
            ctx.strokeStyle = strokeColor;
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        };

        // Event Listeners
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        
        clearBtn.addEventListener('click', () => {
            socket.emit('clear');
        });

        // Socket Events
        socket.on('draw', (data) => {
            renderDraw(data.x, data.y, data.color);
            ctx.beginPath(); // Ensure the remote user's path doesn't link to yours
        });

        socket.on('clear', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    </script>
</body>
</html>