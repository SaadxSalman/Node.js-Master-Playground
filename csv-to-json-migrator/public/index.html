<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><title>CSV Migrator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="bg-slate-900 text-white flex items-center justify-center h-screen">
    <div class="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-slate-700">
        <h1 class="text-2xl font-bold mb-2 text-blue-400">Data Migrator</h1>
        <p class="text-slate-400 text-sm mb-6">Mastering Streams at github.com/saadxsalman</p>
        
        <form id="uploadForm" class="space-y-4">
            <input type="file" name="csvfile" id="fileInput" class="block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-500 cursor-pointer">
            <button type="submit" class="w-full bg-blue-600 py-3 rounded-lg font-bold hover:bg-blue-500 transition-all">Upload & Migrate</button>
        </form>

        <div id="progressContainer" class="hidden mt-8">
            <div class="flex justify-between mb-1">
                <span class="text-sm font-medium text-blue-400" id="statusText">Processing...</span>
                <span class="text-sm font-medium text-blue-400" id="percentText">0%</span>
            </div>
            <div class="w-full bg-slate-700 rounded-full h-2.5">
                <div id="progressBar" class="bg-blue-500 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        const form = document.getElementById('uploadForm');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const percentText = document.getElementById('percentText');
        const statusText = document.getElementById('statusText');

        form.onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('csvfile', document.getElementById('fileInput').files[0]);

            progressContainer.classList.remove('hidden');
            
            await fetch('/upload', { method: 'POST', body: formData });
        };

        socket.on('migrationProgress', (data) => {
            progressBar.style.width = data.progress + '%';
            percentText.innerText = data.progress + '%';
            if(data.status) statusText.innerText = data.status;
        });

        socket.on('migrationError', (data) => {
            statusText.innerText = 'Error: ' + data.message;
            statusText.classList.add('text-red-500');
        });
    </script>
</body>
</html>